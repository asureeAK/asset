<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Asset Handover Form</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .main-container { display: flex; gap: 42px; align-items: flex-start; }
        .form-section, .preview-section { flex: 1; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #bbb; padding: 8px; text-align: center; vertical-align: top; }
        th { background: #f0f0f0; }
        button { margin-top: 10px; padding: 8px 16px; font-weight: 600; }
        .delete-btn { color: red; background: none; border: none; cursor: pointer; }
        textarea, input[type="text"] { width: 95%; margin-top: 3px; }
        .preview-section { background: #fafafa; padding: 18px; border: 1px solid #eee; min-height: 250px; }
        .email-table { border-collapse: collapse; width: 100%; margin: 12px 0;}
        .email-table th, .email-table td { border: 1px solid #bbb; padding: 6px; vertical-align: top; }
        .email-table th { background: #eaeaea;}
        .small-label { font-size: 0.95em; color: #444; margin-right: 8px;}
        ul { margin-top: 0.5em; margin-bottom: 0.5em; }
    </style>
</head>
<body>
<div class="main-container">
    <div class="form-section">
        <h2>Asset Handover Form</h2>
        <label>Relieved Employee:
            <input type="text" id="relievedEmployee">
        </label><br>
        <label>Asset Assigned Person:
            <input type="text" id="assignedPerson">
        </label><br>
        <div><strong>Assets Returned</strong></div>
        <table id="assetsTable">
            <thead>
                <tr>
                    <th>Asset Name</th>
                    <th>Asset Tag</th>
                    <th>Serial No</th>
                    <th class="small-label">Charging Adapter</th>
                    <th class="small-label">Bag</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button type="button" onclick="addAssetRow()">+ Add Asset</button>
        <div><strong>Assets Allocated</strong></div>
        <table id="assignmentsTable">
            <thead>
                <tr>
                    <th>Asset Name</th>
                    <th>Asset Tag</th>
                    <th>Serial No</th>
                    <th class="small-label">Charging Adapter</th>
                    <th class="small-label">Bag</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button type="button" onclick="addAssignmentRow()">+ Add Allocated Asset</button>
        <div>General Comments (optional):</div>
        <textarea id="comments" rows="2"></textarea>
        <br>
        <label>IT Member Name:
            <input type="text" id="itMember">
        </label>
        <br>
        <button type="button" onclick="updatePreview()">Show Preview</button>
    </div>
    <div class="preview-section">
        <h2>Preview Email</h2>
        <div id="emailPreview"></div>
    </div>
</div>
<script>
function addAssetRow() {
    let tbody = document.getElementById('assetsTable').querySelector('tbody');
    let row = tbody.insertRow();
    row.innerHTML =
        `<td><input type="text" placeholder="Asset Name"></td>
         <td><input type="text" placeholder="Asset Tag"></td>
         <td><input type="text" placeholder="Serial No"></td>
         <td><input type="checkbox" class="withAdapter" onclick="updatePreview()" checked></td>
         <td><input type="checkbox" class="withBag" onclick="updatePreview()" checked></td>
         <td><button class="delete-btn" onclick="deleteRow(this)">X</button></td>`;
}
function addAssignmentRow() {
    let tbody = document.getElementById('assignmentsTable').querySelector('tbody');
    let row = tbody.insertRow();
    row.innerHTML =
        `<td><input type="text" placeholder="Asset Name"></td>
         <td><input type="text" placeholder="Asset Tag"></td>
         <td><input type="text" placeholder="Serial No"></td>
         <td><input type="checkbox" class="withAdapter" onclick="updatePreview()" checked></td>
         <td><input type="checkbox" class="withBag" onclick="updatePreview()" checked></td>
         <td><button class="delete-btn" onclick="deleteRow(this)">X</button></td>`;
}
function deleteRow(btn) {
    btn.closest('tr').remove();
    updatePreview();
}
function getTableData(tableId) {
    let rows = document.querySelectorAll(`#${tableId} tbody tr`);
    let data = [];
    rows.forEach(row => {
        let cells = row.querySelectorAll('input');
        if (
            cells.length >= 5 &&
            (cells[0].value||cells[1].value||cells[2].value)
        ) {
            data.push({
                name: cells[0].value,
                tag: cells[1].value,
                serial: cells[2].value,
                withAdapter: cells[3].checked,
                withBag: cells[4].checked
            });
        }
    });
    return data;
}
function renderRetTable(rows) {
    let html = `<table class="email-table"><thead>
      <tr><th>Asset Name</th><th>Asset Tag</th><th>Serial No</th></tr></thead><tbody>`;
    rows.forEach(r => {
        html += `<tr><td>${r.name}</td><td>${r.tag}</td><td>${r.serial}</td></tr>`;
        if (r.withAdapter) {
            html += `<tr><td>Charging Adapter</td><td>-</td><td>-</td></tr>`;
        }
        if (r.withBag) {
            html += `<tr><td>Bag</td><td>-</td><td>-</td></tr>`;
        }
    });
    html += "</tbody></table>";
    return html;
}
function renderAllocTable(rows) {
    let html = `<table class="email-table"><thead>
        <tr>
            <th>Asset Name</th>
            <th>Asset Tag</th>
            <th>Serial No</th>
        </tr>
    </thead><tbody>`;
    rows.forEach(r => {
        html += `<tr><td>${r.name}</td><td>${r.tag}</td><td>${r.serial}</td></tr>`;
        if (r.withAdapter) {
            html += `<tr><td>Charging Adapter</td><td>-</td><td>-</td></tr>`;
        }
        if (r.withBag) {
            html += `<tr><td>Bag</td><td>-</td><td>-</td></tr>`;
        }
    });
    html += "</tbody></table>";
    return html;
}
function getStatusPhrase(adapter, bag) {
    let phrases = [];
    phrases.push(adapter ? "with charging adapter" : "without charging adapter");
    phrases.push(bag ? "with bag" : "without bag");
    return phrases.join(" and ");
}
function getItemComment(asset, person, action) {
    let status = getStatusPhrase(asset.withAdapter, asset.withBag);
    return `- I ${action} the ${asset.name} ${status} ${action==='received' ? 'from' : 'to'} ${person}.`;
}
function updatePreview() {
    let relieved = document.getElementById('relievedEmployee').value.trim();
    let assigned = document.getElementById('assignedPerson').value.trim();
    let itMember = document.getElementById('itMember').value.trim();
    let comments = document.getElementById('comments').value.trim();
    let returnedAssets = getTableData('assetsTable');
    let assignedAssets = getTableData('assignmentsTable');

    let html = `<div><strong>Subject:</strong> Asset Handover${relieved ? ' – ' + relieved : ''}</div><br>`;
    html += `<div>Hi Team,<br><br></div>`;

    if(relieved && returnedAssets.length) {
        html += `I have received the following assets from <strong>${relieved}</strong>:<br>`;
        html += renderRetTable(returnedAssets);
    }
    if(relieved && !returnedAssets.length) {
        html += `This is to confirm that <strong>${relieved}</strong> has completed asset handover.<br>`;
    }

    if(assigned && assignedAssets.length) {
        html += `<br><strong>Assets Allocated – ${assigned}</strong>`;
        html += renderAllocTable(assignedAssets);
    }

    if(comments) {
        html += `<br><strong>General Comments:</strong> ${comments}<br>`;
    }
    html += `<br>Regards,<br>${itMember ? itMember : "<SNMG Member Name>"}`;
    html += `<br><br><strong>Item Summary:</strong><br><ul>`;
    returnedAssets.forEach(function(asset){
        html += `<li>${getItemComment(asset, relieved, "received")}</li>`;
    });
    assignedAssets.forEach(function(asset){
        html += `<li>${getItemComment(asset, assigned, "allocated")}</li>`;
    });
    html += `</ul>`;
    document.getElementById('emailPreview').innerHTML = html;
}
addAssetRow();
addAssignmentRow();
updatePreview();
</script>
</body>
</html>
